document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('wealthForm');
  const checkBtn = document.getElementById('checkBtn');
  const videoBtn = document.getElementById('videoBtn');
  const problemSection = document.getElementById('problemSection');
  const videoSection = document.getElementById('videoSection');
  const problemSelect = document.getElementById('problemSelect');
  const pumpTypeSelect = document.getElementById('pumpTypeSelect');
  const solutionBox = document.getElementById('solutionBox');
  const resultBox = document.getElementById('resultBox');
  const videoBox = document.getElementById('videoBox');
  const pumpTypeGrid = document.getElementById('pumpTypeGrid');
  const pumpTypeHidden = document.getElementById('pumpTypeDiagnosticSelect');

  const diagnosticMap = {
    "Pump does not deliver water (рдкрдВрдк рдкрд╛рдиреА рдирд╣реАрдВ рджреЗрддрд╛)": [1,3,6,16,22,23,47],
    "Insufficient capacity delivered (рдЕрдкрд░реНрдпрд╛рдкреНрдд рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди)": [2,3,4,5,6,7,8,9,10,13,16,19,21,22,28,29,30],
    "Insufficient pressure delivered (рдЕрдкрд░реНрдпрд╛рдкреНрдд рджрдмрд╛рд╡ рдкреНрд░рджрд╛рди)": [5,13,15,16,19,21,28,29,30],
    "Pump loses prime after starting (рдкрдВрдк рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдкреНрд░рд╛рдЗрдо рдЦреЛ рджреЗрддрд╛ рд╣реИ)": [2,3,5,6,7,8,10,11,12],
    "Pump requires excessive power (рдкрдВрдк рдХреЛ рдЕрддреНрдпрдзрд┐рдХ рдмрд┐рдЬрд▓реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛)": [14,15,16,17,18,19,22,23,25,26,28,32,33,36],
    "Leaks excessively (рдЕрддреНрдпрдзрд┐рдХ рд░рд┐рд╕рд╛рд╡)": [12,23,25,31,32,33,34,35,37,38,39],
    "Seal has short life (рд╕реАрд▓ рдХреА рдЖрдпреБ рдХрдо)": [11,12,23,25,27,31,32,33,34,35,36,37,38,39],
    "Pump vibrates or is noisy (рдкрдВрдк рдХрдВрдкрди рдпрд╛ рд╢реЛрд░ рдХрд░рддрд╛ рд╣реИ)": [2,3,4,9,10,20,22,23,24,25,26,27,29,34,35,40,41,42,43,44,45,46],
    "Bearings have short life (рдмреЗрдпрд░рд┐рдВрдЧ рдХреА рдЖрдпреБ рдХрдо)": [23,25,26,27,34,35,40,41,42,43,44,45,46],
    "Pump overheats and seizes (рдкрдВрдк рдЕрдзрд┐рдХ рдЧрд░реНрдо рд╣реЛрдХрд░ рдЬрд╛рдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ)": [1,4,20,21,23,26,27,34,35,40]
  };

  const causeDescriptions = {
    1: "Pump not primed (рдкрдВрдк рдореЗрдВ рдкрд╛рдиреА рдирд╣реАрдВ рднрд░рд╛ рд╣реИ)", 2: "Suction pipe not filled with liquid (рд╕рдХреНрд╢рди рдкрд╛рдЗрдк рдореЗрдВ рддрд░рд▓ рдирд╣реАрдВ рд╣реИ)", 3: "Suction lift too high (рдкрд╛рдиреА рдХреА рдЧрд╣рд░рд╛рдИ рдЬрд╝рдореАрди рд╕реЗ 18 рдлреАрдЯ рд╕реЗ рдЬрд╝реНрдпрд╛рджрд╛ рд╣реИ)",
    4: "Low suction pressure margin (рдХрдо рд╕рдХреНрд╢рди рджрдмрд╛рд╡ рдорд╛рд░реНрдЬрд┐рди)", 5: "Air/gas in liquid (рддрд░рд▓ рдореЗрдВ рд╣рд╡рд╛/рдЧреИрд╕)", 6: "Air pocket in suction line (рд╕рдХреНрд╢рди рд▓рд╛рдЗрди рдореЗрдВ рд▓реАрдХреЗрдЬ рд╣реИ)",
    7: "Air leaks in suction line (рд╕рдХреНрд╢рди рд▓рд╛рдЗрди рдореЗрдВ рд╣рд╡рд╛ рдХрд╛ рд░рд┐рд╕рд╛рд╡)", 8: "Air leaks through stuffing box (рд╕реНрдЯрдлрд┐рдВрдЧ рдмреЙрдХреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рд╡рд╛ рдХрд╛ рд░рд┐рд╕рд╛рд╡)", 9: "Foot valve clogged or too small (рдлреБрдЯ рд╡рд╛рд▓реНрд╡ рдмрдВрдж рдпрд╛ рдмрд╣реБрдд рдЫреЛрдЯрд╛)",
    10: "Suction pipe not submerged enough (рд╕рдХреНрд╢рди рдкрд╛рдЗрдк рдкрд░реНрдпрд╛рдкреНрдд рдбреВрдмрд╛ рдирд╣реАрдВ рд╣реИ)", 11: "Water seal pipe plugged (рд╡реЙрдЯрд░ рд╕реАрд▓ рдкрд╛рдЗрдк рдмрдВрдж)", 12: "Seal cage misaligned (рд╕реАрд▓ рдХреЗрдЬ рдЧрд▓рдд рд╕рдВрд░реЗрдЦрд┐рдд)",
    13: "Pump speed too low (рдкрдВрдк рдХреА рдЧрддрд┐ рдмрд╣реБрдд рдХрдо рд╣реИ)", 14: "Pump speed too high (рдкрдВрдк рдХреА рдЧрддрд┐ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИ)", 15: "Wrong rotation direction (рдЧрд▓рдд рдШреВрд░реНрдгрди рджрд┐рд╢рд╛)",
    16: "System head too high (рдкрд╛рдиреА рдлреЗрдВрдХрдиреЗ рдХреА рдКрдБрдЪрд╛рдИ рдиреЗрдо рдкреНрд▓реЗрдЯ рдХреА рдКрдБрдЪрд╛рдИ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ)", 17: "System head too low (рд╕рд┐рд╕реНрдЯрдо рд╣реЗрдб рдмрд╣реБрдд рдХрдо рд╣реИ)", 18: "Liquid density mismatch (рддрд░рд▓ рдШрдирддреНрд╡ рдХрд╛ рдореЗрд▓ рдирд╣реАрдВ)",
    19: "Liquid viscosity mismatch (рддрд░рд▓ рдЪрд┐рдкрдЪрд┐рдкрд╛рд╣рдЯ рдХрд╛ рдореЗрд▓ рдирд╣реАрдВ)", 20: "Very low capacity operation (рдмрд╣реБрдд рдХрдо рдХреНрд╖рдорддрд╛ рд╕рдВрдЪрд╛рд▓рди)", 21: "Unsuitable parallel pump operation (рдЕрдиреБрдкрдпреБрдХреНрдд рд╕рдорд╛рдирд╛рдВрддрд░ рдкрдВрдк рд╕рдВрдЪрд╛рд▓рди)",
    22: "Foreign matter in impeller (рдЗрдореНрдкреЗрд▓рд░ рдореЗрдВ рд╡рд┐рджреЗрд╢реА рдкрджрд╛рд░реНрде)", 23: "Pump misalignment (рдкрдВрдк рдЧрд▓рдд рд╕рдВрд░реЗрдЦрдг)", 24: "Weak foundation (рдХрдордЬреЛрд░ рдиреАрдВрд╡)",
    25: "Bent shaft (рдореБрдбрд╝реА рд╣реБрдИ рд╢рд╛рдлреНрдЯ)", 26: "Rubbing parts (рд░рдЧрдбрд╝рдиреЗ рд╡рд╛рд▓реЗ рднрд╛рдЧ)", 27: "Worn bearings (рдШрд┐рд╕реЗ рд╣реБрдП рдмреЗрдпрд░рд┐рдВрдЧ)", 28: "Worn wearing rings (рдШрд┐рд╕реЗ рд╣реБрдП рд╡рд┐рдпрд░рд┐рдВрдЧ рд░рд┐рдВрдЧреНрд╕)",
    29: "Damaged impeller (рдХреНрд╖рддрд┐рдЧреНрд░рд╕реНрдд рдЗрдореНрдкреЗрд▓рд░)", 30: "Leaky casing gasket (рд▓реАрдХреА рдХреЗрд╕рд┐рдВрдЧ рдЧреИрд╕реНрдХреЗрдЯ)", 31: "Worn shaft sleeves (рдШрд┐рд╕реЗ рд╣реБрдП рд╢рд╛рдлреНрдЯ рд╕реНрд▓реАрд╡реНрд╕)",
    32: "Improper packing (рдЕрдиреБрдЪрд┐рдд рдкреИрдХрд┐рдВрдЧ)", 33: "Wrong packing type (рдЧрд▓рдд рдкреИрдХрд┐рдВрдЧ рдкреНрд░рдХрд╛рд░)", 34: "Off-center shaft (рдХреЗрдВрджреНрд░ рд╕реЗ рд╣рдЯреА рд╣реБрдИ рд╢рд╛рдлреНрдЯ)",
    35: "Rotor imbalance (рд░реЛрдЯрд░ рдЕрд╕рдВрддреБрд▓рди)", 36: "Overtight gland (рдЕрддреНрдпрдзрд┐рдХ рдХрд╕рд╛ рд╣реБрдЖ рдЧреНрд▓реИрдВрдб)", 37: "No cooling liquid (рдХреЛрдИ рд╢реАрддрд▓рди рддрд░рд▓ рдирд╣реАрдВ)",
    38: "Stuffing box clearance too large (рд╕реНрдЯрдлрд┐рдВрдЧ рдмреЙрдХреНрд╕ рдХреНрд▓реАрдпрд░реЗрдВрд╕ рдмрд╣реБрдд рдмрдбрд╝рд╛)", 39: "Dirty sealing liquid (рдЧрдВрджрд╛ рд╕реАрд▓рд┐рдВрдЧ рддрд░рд▓)", 40: "Excessive thrust (рдЕрддреНрдпрдзрд┐рдХ рдереНрд░рд╕реНрдЯ)",
    41: "Overgreased or overheated bearings (рдЕрддреНрдпрдзрд┐рдХ рдЧреНрд░реАрд╕ рдпрд╛ рдЧрд░реНрдо рдмреЗрдпрд░рд┐рдВрдЧ)", 42: "Lack of lubrication (рд╕реНрдиреЗрд╣рди рдХреА рдХрдореА)",
    43: "Improper bearing installation (рдЕрдиреБрдЪрд┐рдд рдмреЗрдпрд░рд┐рдВрдЧ рд╕реНрдерд╛рдкрдирд╛)", 44: "Dirty bearings (рдЧрдВрджреЗ рдмреЗрдпрд░рд┐рдВрдЧ)", 45: "Rusty bearings (рдЬрдВрдЧ рд▓рдЧреЗ рдмреЗрдпрд░рд┐рдВрдЧ)",
    46: "Condensation in bearing housing (рдмреЗрдпрд░рд┐рдВрдЧ рд╣рд╛рдЙрд╕рд┐рдВрдЧ рдореЗрдВ рд╕рдВрдШрдирди)", 47: "Pump speed too low (рдкрдВрдк рдХреА рдЧрддрд┐ рдмрд╣реБрдд рдХрдо рд╣реИ)"
  };

  // Cause animations mapping - removed all symbols
  const causeAnimations = {
    1: "", 2: "", 3: "", 4: "", 5: "", 6: "", 7: "", 8: "", 9: "", 10: "",
    11: "", 12: "", 13: "", 14: "", 15: "", 16: "", 17: "", 18: "", 19: "", 20: "",
    21: "", 22: "", 23: "", 24: "", 25: "", 26: "", 27: "", 28: "", 29: "", 30: "",
    31: "", 32: "", 33: "", 34: "", 35: "", 36: "", 37: "", 38: "", 39: "", 40: "",
    41: "", 42: "", 43: "", 44: "", 45: "", 46: "", 47: ""
  };

  const videoLinks = {
    mmb: "https://youtu.be/YzIg_zQh3_g?si=740pPZlXMcHnGbEf",
    pp: "https://youtu.be/YGmssQ09yF4?si=T1D7cZ1CGikS2FeN",
    bws: null,
    ow: null,
    type5: null,
    type6: null
  };

  // Pump type image selection
  if (pumpTypeGrid) {
    pumpTypeGrid.addEventListener('click', (e) => {
      const pumpItem = e.target.closest('.pump-type-item');
      if (!pumpItem) return;
      
      // Remove selection from all items
      document.querySelectorAll('.pump-type-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // Add selection to clicked item
      pumpItem.classList.add('selected');
      
      // Update hidden input value
      if (pumpTypeHidden) {
        pumpTypeHidden.value = pumpItem.dataset.value;
      }
    });
  }

  // Toggle sections
  checkBtn.addEventListener('click', () => {
    checkBtn.classList.add('active');
    videoBtn.classList.remove('active');
    problemSection.style.display = 'block';
    videoSection.style.display = 'none';
    videoBox.innerHTML = "";
    pumpTypeSelect.value = "";
  });

  videoBtn.addEventListener('click', () => {
    videoBtn.classList.add('active');
    checkBtn.classList.remove('active');
    problemSection.style.display = 'none';
    videoSection.style.display = 'block';
    solutionBox.innerHTML = "";
    problemSelect.value = "";
  });

  // Show causes when problem is selected
  problemSelect.addEventListener('change', () => {
    const selected = problemSelect.value;
    const causes = diagnosticMap[selected];
    if (!causes) {
      solutionBox.innerHTML = "";
      return;
    }

    const list = causes.map(num => {
      return `
        <div class="cause-item">
          <div class="cause-text">${causeDescriptions[num]}</div>
        </div>
      `;
    }).join("");
    
    solutionBox.innerHTML = `
      <h3>ЁЯФз Possible Causes:</h3>
      <div style="margin-top: 15px;">${list}</div>
    `;
  });

  // Show video when pump type is selected
  pumpTypeSelect.addEventListener('change', () => {
    const selected = pumpTypeSelect.value;
    const link = videoLinks[selected];

    if (link) {
      videoBox.innerHTML = `
        <h3>ЁЯОе Troubleshooting Video for ${selected.toUpperCase()}:</h3>
        <a href="${link}" target="_blank">Watch Now</a>
      `;
    } else {
      videoBox.innerHTML = `<p>ЁЯУ╣ Video for this pump type is coming soon.</p>`;
    }
  });

  // Form submit handler
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const selectedProblem = problemSelect.value;
    const selectedPumpType = pumpTypeHidden?.value || '';

    if (!selectedProblem) {
      resultBox.innerHTML = `тЪая╕П Please select a problem.`;
      return;
    }

    let message = `тЬЕ Submitted. Problem: <strong>${selectedProblem}</strong>`;
    if (selectedPumpType) {
      const selectedItem = document.querySelector(`[data-value="${selectedPumpType}"]`);
      const pumpName = selectedItem ? selectedItem.querySelector('.pump-name').textContent : selectedPumpType;
      message += `<br>Pump type: <strong>${pumpName}</strong>`;
    }
    resultBox.innerHTML = message;
  });
});
